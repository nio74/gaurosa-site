# gaurosa.it - Static Next.js site served from out/
# DO NOT EDIT - managed by deploy script
RewriteEngine On
RewriteBase /

# ── 1. API PHP (root level) ──────────────────────────────────────────
RewriteRule ^api-[^/]+\.php$ - [L]
RewriteRule ^maintenance\.html$ - [L]
RewriteRule ^maintenance\.json$ - [L]

# ── 2. API folder ────────────────────────────────────────────────────
RewriteRule ^api(/.*)?$ api$1 [L]

# ── 3. Static files: serve from out/ ────────────────────────────────
# Exact file match in out/
RewriteCond %{DOCUMENT_ROOT}/out%{REQUEST_URI} -f
RewriteRule ^(.*)$ out/$1 [L]

# Directory with trailing slash → serve out/path/index.html
RewriteCond %{DOCUMENT_ROOT}/out%{REQUEST_URI}index.html -f
RewriteRule ^(.*/)$ out/$1index.html [L]

# Path without trailing slash → try out/path/index.html
RewriteCond %{DOCUMENT_ROOT}/out%{REQUEST_URI}/index.html -f
RewriteRule ^(.+[^/])$ out/$1/index.html [L]

# ── 4. Product detail fallback ───────────────────────────────────────
# For /prodotti/ANYCODE not pre-generated, serve the shell page.
# ProductDetailClient reads the code from the URL client-side via usePathname().
RewriteCond %{REQUEST_URI} ^/prodotti/[^/]+/?$
RewriteCond %{DOCUMENT_ROOT}/out/prodotti/_shell/index.html -f
RewriteRule ^prodotti/[^/]+/?$ out/prodotti/_shell/index.html [L]

# ── 5. 404 fallback ──────────────────────────────────────────────────
ErrorDocument 404 /out/404.html
